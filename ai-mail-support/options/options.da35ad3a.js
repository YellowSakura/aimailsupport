function e(e,t,a,o){Object.defineProperty(e,t,{get:a,set:o,enumerable:!0,configurable:!0})}var t=globalThis,a={},o={},s=t.parcelRequire693b;null==s&&((s=function(e){if(e in a)return a[e].exports;if(e in o){var t=o[e];delete o[e];var s={id:e,exports:{}};return a[e]=s,t.call(s.exports,s,s.exports),s.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},t.parcelRequire693b=s);var r=s.register;r("9v09t",function(t,a){async function o(e){let t=null;try{t=(await browser.storage.sync.get(e))[e]}catch(t){i(`An error occurred while retrieving the config for ${e}: ${t}`,"error")}return t}async function r(){let e=null;try{e=await browser.storage.sync.get(null)}catch(e){i(`An error occurred while retrieving configs: ${e}`,"error")}return e}function n(e,t="en"){let a=new Intl.DisplayNames([t],{type:"language"});try{return a.of(e)}catch(e){i(`Error in retrieving the language name from the code: ${e}`,"error");return}}function g(){document.querySelectorAll("[data-l10n-ref]").forEach(e=>{let t=e.getAttribute("data-l10n-ref");e.innerHTML=messenger.i18n.getMessage(t)})}async function i(e,t="log"){!0===await o("debugMode")&&console[t](`AI Mail Support: ${e}`)}e(t.exports,"getConfig",()=>o),e(t.exports,"logMessage",()=>i),e(t.exports,"getConfigs",()=>r),e(t.exports,"getLanguageNameFromCode",()=>n),e(t.exports,"localizeNodes",()=>g),s("cMDKG")}),r("cMDKG",function(t,a){var o;e(t.exports,"mask",()=>i);let s=((o={}).CREDIT_CARD="CREDIT_CARD",o.CRYPTO="CRYPTO",o.DATE_TIME="DATE_TIME",o.EMAIL_ADDRESS="EMAIL_ADDRESS",o.IBAN_CODE="IBAN_CODE",o.IP_ADDRESS="IP_ADDRESS",o.PHONE_NUMBER="PHONE_NUMBER",o.URL="URL",o.CVV="CVV",o.BIC_SWIFT="BIC_SWIFT",o.US_BANK_NUMBER="US_BANK_NUMBER",o.US_DRIVER_LICENSE="US_DRIVER_LICENSE",o.US_ITIN="US_ITIN",o.US_PASSPORT="US_PASSPORT",o.US_SSN="US_SSN",o.UK_NHS="UK_NHS",o.UK_NINO="UK_NINO",o.ES_NIF="ES_NIF",o.ES_NIE="ES_NIE",o.IT_FISCAL_CODE="IT_FISCAL_CODE",o.IT_DOCUMENT="IT_DOCUMENT",o.IT_VAT_CODE="IT_VAT_CODE",o.PL_PESEL="PL_PESEL",o.FI_PERSONAL_IDENTITY_CODE="FI_PERSONAL_IDENTITY_CODE",o.SG_NRIC_FIN="SG_NRIC_FIN",o.SG_UEN="SG_UEN",o.AU_ABN="AU_ABN",o.AU_ACN="AU_ACN",o.AU_TFN="AU_TFN",o.AU_MEDICARE="AU_MEDICARE",o.IN_PAN="IN_PAN",o.IN_AADHAAR="IN_AADHAAR",o.IN_VEHICLE_REGISTRATION="IN_VEHICLE_REGISTRATION",o.IN_VOTER="IN_VOTER",o.IN_PASSPORT="IN_PASSPORT",o.KR_RRN="KR_RRN",o),r=RegExp("(?:(?:[sS][wW][iI][fF][tT])|(?:[bB][iI][cC])|(?:[bB][aA][nN][kK][\\s-]?[cC][oO][dD][eE])|(?:[sS][wW][iI][fF][tT][\\s-]?[cC][oO][dD][eE])|(?:[bB][iI][cC][\\s-]?[cC][oO][dD][eE]))[:\\s=]+([A-Z]{4}[A-Z]{2}[A-Z0-9]{2}(?:[A-Z0-9]{3})?)\\b","g"),n={[s.CREDIT_CARD]:[/\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g],[s.CRYPTO]:[/\b[13][a-km-zA-HJ-NP-Z1-9]{25,34}\b/g],[s.DATE_TIME]:[/\b(0[1-9]|1[0-2])[/-](0[1-9]|[12]\d|3[01])[/-](19|20)\d{2}\b/g],[s.EMAIL_ADDRESS]:[/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/g,RegExp("(?<=[?&=/])[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}","g")],[s.IBAN_CODE]:[/\b[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}\b/g],[s.IP_ADDRESS]:[/\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/g,/\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b/g,/\b(?:[0-9a-fA-F]{1,4}:){1,7}:|:(?::[0-9a-fA-F]{1,4}){1,7}\b/g],[s.PHONE_NUMBER]:[/\b(\+\d{1,3}[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b/g],[s.URL]:[/\bhttps?:\/\/(?:[-\w.])+(?::[0-9]+)?(?:\/(?:[\w/_.])*(?:\?(?:[\w&=%.])*)?(?:#(?:[\w.])*)?)?/g],[s.CVV]:[/\b(?:cvv|cvc|security\s*code|card\s*code)[\s:=]*[0-9]{3,4}\b/gi],[s.BIC_SWIFT]:[r],[s.US_BANK_NUMBER]:[/\b\d{8,17}\b/g],[s.US_DRIVER_LICENSE]:[/\b[A-Z]\d{7}\b/g],[s.US_ITIN]:[/\b9\d{2}-\d{2}-\d{4}\b/g],[s.US_PASSPORT]:[/\b[A-Z]\d{8}\b/g],[s.US_SSN]:[/\b\d{3}-\d{2}-\d{4}\b|\b\d{9}\b/g],[s.UK_NHS]:[/\b\d{3} \d{3} \d{4}\b/g],[s.UK_NINO]:[/\b[A-Z]{2}\d{6}[A-Z]\b/g],[s.ES_NIF]:[/\b\d{8}[A-Z]\b/g],[s.ES_NIE]:[/\b[XYZ]\d{7}[A-Z]\b/g],[s.IT_FISCAL_CODE]:[/\b[A-Z]{6}\d{2}[A-Z]\d{2}[A-Z]\d{3}[A-Z]\b/g],[s.IT_DOCUMENT]:[/\b[A-Z]{2}\d{7}\b/g],[s.IT_VAT_CODE]:[/\bIT\d{11}\b/g],[s.PL_PESEL]:[/\b\d{11}\b/g],[s.FI_PERSONAL_IDENTITY_CODE]:[/\b\d{6}[+-A]\d{3}[A-Z0-9]\b/g],[s.SG_NRIC_FIN]:[/\b[A-Z]\d{7}[A-Z]\b/g],[s.SG_UEN]:[/\b\d{8}[A-Z]\b|\b\d{9}[A-Z]\b/g],[s.AU_ABN]:[/\b\d{2} \d{3} \d{3} \d{3}\b/g],[s.AU_ACN]:[/\b\d{3} \d{3} \d{3}\b/g],[s.AU_TFN]:[/\b\d{9}\b/g],[s.AU_MEDICARE]:[/\b\d{4} \d{5} \d{1}\b/g],[s.IN_PAN]:[/\b[A-Z]{5}\d{4}[A-Z]\b/g],[s.IN_AADHAAR]:[/\b\d{4} \d{4} \d{4}\b/g],[s.IN_VEHICLE_REGISTRATION]:[/\b[A-Z]{2}\d{2}[A-Z]{2}\d{4}\b/g],[s.IN_VOTER]:[/\b[A-Z]{3}\d{7}\b/g],[s.IN_PASSPORT]:[/\b[A-Z]\d{7}\b/g],[s.KR_RRN]:[/\b\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])-[1-4]\d{6}\b/g]};function g(e,t=Object.values(s)){if(!e)return e;for(let a of t){let t=n[a];if(t&&t.length)for(let o of t)e=e.replace(o,`<${a}>`)}return e}function i(e,t){let{customRules:a=[],fixedPiiEntities:o=[]}=t||{},s=function(e){if(!e)return e;let t=/(?:\u200B|\u200C|\u200D|\u2060|\uFEFF)/g;try{return e.normalize("NFKC").replace(t,"")}catch{return e.replace(t,"")}}(e);return a.length>0&&(s=function(e,t){if(!e||!t||0===t.length)return e;for(let a of t)a.pattern&&void 0!==a.replacement&&(e=e.replace(a.pattern,`<${a.replacement}>`));return e}(s,a)),o.length>0?g(s,o):g(s)}}),r("hYzqD",function(t,a){e(t.exports,"GroqProvider",()=>n);var o=s("ifZGS"),r=s("9v09t");class n extends o.GenericProvider{apiKey;model;constructor(e){super(e),this.apiKey=e.groq.apiKey,this.model=e.groq.model}async analyzeTextIntent(e){return(0,r.logMessage)(`Request to analyze text intent of ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,r.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,r.logMessage)(`Request to explain in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}static async getModels(e){let t={method:"GET",redirect:"follow",headers:new Headers({Authorization:`Bearer ${e}`})},a=await fetch("https://api.groq.com/openai/v1/models",t);if(!a.ok){let e=await a.json();throw Error(`Groq error: ${e.error.message}`)}return(await a.json()).data.map(e=>e.id)}async rephraseText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,r.logMessage)(`Request suggest improvements in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,r.logMessage)(`Request to summarize in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,r.logMessage)(`Request to translate in ${(0,r.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,r.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Authorization",`Bearer ${this.apiKey}`),e.append("Content-Type","application/json"),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,messages:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.groq.com/openai/v1/chat/completions",r);if(o(),!n.ok){let e=await n.json();throw Error(`Groq error: ${e.error.message}`)}return(await n.json()).choices[0].message.content}}}),r("ifZGS",function(t,a){e(t.exports,"GenericProvider",()=>o);class o{mainUserLanguageCode;servicesTimeout;temperature;PROMPTS={ANALYZE_INTENT:"You are an assistant that analyzes the tone and perceived intent of an email and provides the analysis in %language%; describe how the email might come across to the recipient, considering tone, clarity, potential emotional impact, and coherence with the context of the email thread history; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",EXPLAIN:"You are an assistant that explains the content of emails in %language% in a clear and simple way, preserving the original meaning; avoid unnecessary complexity; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",REPHRASE:"You are an assistant that rephrases the content of emails in %language% using a %toneOfVoice% tone of voice; preserve the original meaning; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",SUGGEST_IMPROVEMENTS:"You are an assistant that suggests improvements to the content of emails in %language%, focusing on clarity, tone, and effectiveness; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",SUGGEST_REPLY:"You are an assistant that suggests a reply to the email in %language%, using a %toneOfVoice% tone of voice; ensure the reply is clear and relevant to the sender’s message; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",SUMMARIZE:"You are an assistant that summarizes emails in %language% in a short and clear way, focusing only on the sender’s core message or request; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters",TRANSLATE:"You are an assistant that translates emails into %language% as naturally and accurately as possible; preserve meaning, tone, and style; Ignore formatting, headers, footers, signatures, quoted replies and unusual characters"};constructor(e){this.mainUserLanguageCode=e.mainUserLanguageCode,this.servicesTimeout=e.servicesTimeout,this.temperature=e.temperature}async analyzeTextIntent(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async applyCustomPrompt(e,t){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async explainText(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async getSpeechFromText(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async moderateText(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async rephraseText(e,t){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async suggestImprovementsForText(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async suggestReplyFromText(e,t){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async summarizeText(e){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async testIntegration(){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}async translateText(e,t=null){throw Error(browser.i18n.getMessage("errorInvalidAddonOptions"))}canAnalyzeTextIntent(){return this.analyzeTextIntent!==o.prototype.analyzeTextIntent}canApplyCustomPrompt(){return this.applyCustomPrompt!==o.prototype.applyCustomPrompt}canExplainText(){return this.explainText!==o.prototype.explainText}canModerateText(){return this.moderateText!==o.prototype.moderateText}canRephraseText(){return this.rephraseText!==o.prototype.rephraseText}canSpeechFromText(){return this.getSpeechFromText!==o.prototype.getSpeechFromText}canSuggestImprovementsForText(){return this.suggestImprovementsForText!==o.prototype.suggestImprovementsForText}canSuggestReply(){return this.suggestReplyFromText!==o.prototype.suggestReplyFromText}canSummarizeText(){return this.summarizeText!==o.prototype.summarizeText}canTranslateText(){return this.translateText!==o.prototype.translateText}createAbortSignalWithTimeout(e){let t=new AbortController,a=setTimeout(()=>t.abort(),1e3*e);return{signal:t.signal,clearAbortSignalWithTimeout:function(){clearTimeout(a)}}}}}),r("jYACc",function(t,a){e(t.exports,"LmsProvider",()=>n);var o=s("ifZGS"),r=s("9v09t");class n extends o.GenericProvider{serviceUrl;model;constructor(e){super(e),this.serviceUrl=e.lms.serviceUrl,this.model=e.lms.model}async analyzeTextIntent(e){return(0,r.logMessage)(`Request to analyze text intent of ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,r.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,r.logMessage)(`Request to explain in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}static async getModels(e){let t=await fetch(`${e}/v1/models`,{method:"GET",redirect:"follow"});if(!t.ok){let e=await t.json();throw Error(`AI Studio error: ${e.error.message}`)}return(await t.json()).data.map(e=>e.id)}async rephraseText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,r.logMessage)(`Request suggest improvements in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,r.logMessage)(`Request to summarize in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,r.logMessage)(`Request to translate in ${(0,r.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,r.getLanguageNameFromCode)(t)),e)}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=new Headers;s.append("Content-Type","application/json");let r=JSON.stringify({model:this.model,messages:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),n=await fetch(`${this.serviceUrl}/v1/chat/completions`,{method:"POST",headers:s,body:r,redirect:"follow",signal:a});if(o(),!n.ok){let e=await n.json();throw Error(`LM Studio error: ${e.error}`)}return(await n.json()).choices[0].message.content}}}),r("lp4zK",function(t,a){e(t.exports,"OllamaProvider",()=>n);var o=s("ifZGS"),r=s("9v09t");class n extends o.GenericProvider{serviceUrl;model;constructor(e){super(e),this.serviceUrl=e.ollama.serviceUrl,this.model=e.ollama.model}async analyzeTextIntent(e){return(0,r.logMessage)(`Request to analyze text intent of ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,r.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,r.logMessage)(`Request to explain in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}static async getModels(e){let t=await fetch(`${e}/api/tags`,{method:"GET",redirect:"follow"});if(!t.ok){let e=await t.json();throw Error(`Ollama error: ${e.error.message}`)}return(await t.json()).models.map(e=>({name:e.name,model:e.model}))}async rephraseText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,r.logMessage)(`Request suggest improvements in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,r.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,r.logMessage)(`Request to summarize in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,r.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,r.logMessage)(`Request to translate in ${(0,r.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,r.getLanguageNameFromCode)(t)),e)}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,system:e,prompt:t,options:{temperature:this.temperature},stream:!1}),r=await fetch(`${this.serviceUrl}/api/generate`,{method:"POST",body:s,redirect:"follow",signal:a});if(o(),!r.ok){let e=await r.json();throw Error(`Ollama error: ${e.error}`)}return(await r.json()).response}}});var n=s("9v09t"),g=(s("ifZGS"),s("ifZGS")),n=s("9v09t");class i extends g.GenericProvider{apiKey;model;constructor(e){super(e),this.temperature=e.temperature/2,this.apiKey=e.anthropic.apiKey,this.model=e.anthropic.model}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE,e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("x-api-key",this.apiKey),e.append("anthropic-version","2023-06-01"),e.append("anthropic-dangerous-direct-browser-access","true"),e.append("Content-Type","application/json"),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,temperature:this.temperature,max_tokens:2048,system:e,messages:[{role:"user",content:t}]}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.anthropic.com/v1/messages",r);if(o(),!n.ok){let e=await n.json();throw Error(`Anthropic error: ${e.error.message}`)}return(await n.json()).content[0].text}}var g=s("ifZGS"),n=s("9v09t");class u extends g.GenericProvider{apiKey;constructor(e){super(e),this.apiKey=e.deepseek.apiKey}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE,e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Authorization",`Bearer ${this.apiKey}`),e.append("Content-Type","application/json"),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.deepseek.com/chat/completions",r);if(o(),!n.ok){let e=await n.json();throw Error(`DeepSeek error: ${e.error.message}`)}return(await n.json()).choices[0].message.content}}var g=s("ifZGS"),n=s("9v09t");class l extends g.GenericProvider{apiKey;model;constructor(e){super(e),this.apiKey=e.google.apiKey,this.model=e.google.model}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE,e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Content-Type","application/json"),e.append("x-goog-api-key",this.apiKey),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({system_instruction:{parts:{text:e}},contents:{parts:{text:t}},safety_settings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}],generationConfig:{temperature:this.temperature}}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${this.model}:generateContent`,r);if(o(),!n.ok){let e=await n.json();throw Error(`Google AI error: ${e.error.message}`)}let g=await n.json();if("SAFETY"==g.candidates[0].finishReason)throw Error(`Google AI error: ${browser.i18n.getMessage("errorGoogleGeminiSafetyThresholdExceeded")}`);return g.candidates[0].content.parts[0].text}}var m=s("hYzqD"),d=s("jYACc"),g=s("ifZGS"),n=s("9v09t");class c extends g.GenericProvider{apiKey;model;constructor(e){super(e),this.apiKey=e.mistral.apiKey,this.model=e.mistral.model}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Authorization",`Bearer ${this.apiKey}`),e.append("Accept","application/json"),e.append("Content-Type","application/json"),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,messages:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.mistral.ai/v1/chat/completions",r);if(o(),!n.ok){let e=await n.json();throw Error(`Mistral AI error: ${e.message??e.detail}`)}return(await n.json()).choices[0].message.content}async moderateText(e){let{signal:t,clearAbortSignalWithTimeout:a}=this.createAbortSignalWithTimeout(this.servicesTimeout),o=JSON.stringify({model:"mistral-moderation-latest",input:e}),s={method:"POST",headers:this.getHeaders(),body:o,redirect:"follow",signal:t},r=await fetch("https://api.mistral.ai/v1/moderations",s);if(a(),!r.ok){let e=await r.json();throw Error(`Mistral AI error: ${e.message??e.detail}`)}let n=await r.json();return this.normalizeModerationResponse(n)}normalizeModerationResponse(e){let t=e.results[0].category_scores,a={};for(let e in t)t.hasOwnProperty(e)&&(a[browser.i18n.getMessage(`mailModerate.mistralClassification.${e}`)]=Math.round(100*t[e]));return a}}var h=s("lp4zK"),g=s("ifZGS"),n=s("9v09t");class p extends g.GenericProvider{apiKey;organizationId;model;text2speechAudioQuality;text2speechVoice;text2speechSpeed;constructor(e){super(e),this.apiKey=e.openai.apiKey,this.organizationId=e.openai.organizationId,this.model=e.openai.model,this.text2speechAudioQuality=e.openai.text2speech.audioQuality,this.text2speechVoice=e.openai.text2speech.voice,this.text2speechSpeed=e.openai.text2speech.speed}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async getSpeechFromText(e){if((0,n.logMessage)(`Request for text2speech of the text: ${e}`,"debug"),e.length>4096)throw Error("The text is too long, it exceeds the maximum of 4096 characters");let{signal:t,clearAbortSignalWithTimeout:a}=this.createAbortSignalWithTimeout(this.servicesTimeout),o=JSON.stringify({model:this.text2speechAudioQuality,input:e,voice:this.text2speechVoice,speed:this.text2speechSpeed}),s={method:"POST",headers:this.getHeaders(),body:o,redirect:"follow",signal:t},r=await fetch("https://api.openai.com/v1/audio/speech",s);if(a(),!r.ok){let e=await r.json();throw Error(`OpenAI error: ${e.error.message}`)}return await r.blob()}async moderateText(e){let{signal:t,clearAbortSignalWithTimeout:a}=this.createAbortSignalWithTimeout(this.servicesTimeout),o=JSON.stringify({model:"omni-moderation-latest",input:e}),s={method:"POST",headers:this.getHeaders(),body:o,redirect:"follow",signal:t},r=await fetch("https://api.openai.com/v1/moderations",s);if(a(),!r.ok){let e=await r.json();throw Error(`OpenAI error: ${e.error.message}`)}let n=await r.json();return this.normalizeModerationResponse(n)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Authorization",`Bearer ${this.apiKey}`),e.append("Content-Type","application/json"),this.organizationId&&e.append("OpenAI-Organization",this.organizationId),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,input:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.openai.com/v1/responses",r);if(o(),!n.ok){let e=await n.json();throw Error(`OpenAI error: ${e.error.message}`)}return(await n.json()).output[0].content[0].text}normalizeModerationResponse(e){let t=e.results[0].category_scores,a={};for(let e in t)t.hasOwnProperty(e)&&(a[browser.i18n.getMessage("mailModerate.openaiClassification."+e.replace(/\//g,"_"))]=Math.round(100*t[e]));return a}}var g=s("ifZGS"),n=s("9v09t");class C extends g.GenericProvider{apiKey;model;constructor(e){super(e),this.apiKey=e.xai.apiKey,this.model=e.xai.model}async analyzeTextIntent(e){return(0,n.logMessage)(`Request to analyze text intent of ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.ANALYZE_INTENT.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async applyCustomPrompt(e,t){return(0,n.logMessage)(`Applying custom user prompt "${e}" to input text: "${t}"`,"debug"),this.manageMessageContent(e,t)}async explainText(e){return(0,n.logMessage)(`Request to explain in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.EXPLAIN.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async rephraseText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to rephrase in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.REPHRASE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async suggestImprovementsForText(e){return(0,n.logMessage)(`Request suggest improvements in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} for the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_IMPROVEMENTS.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async suggestReplyFromText(e,t){return(0,n.logMessage)(`Request to use the tone of voice "${t}" to suggest a reply in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} to the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.SUGGEST_REPLY.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)).replace("%toneOfVoice%",t),e)}async summarizeText(e){return(0,n.logMessage)(`Request to summarize in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)} the text: ${e} in ${(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)}`,"debug"),this.manageMessageContent(this.PROMPTS.SUMMARIZE.replace("%language%",(0,n.getLanguageNameFromCode)(this.mainUserLanguageCode)),e)}async testIntegration(){await this.translateText("Hi!")}async translateText(e,t=null){return t=t??this.mainUserLanguageCode,(0,n.logMessage)(`Request to translate in ${(0,n.getLanguageNameFromCode)(t)} the text: ${e}`,"debug"),this.manageMessageContent(this.PROMPTS.TRANSLATE.replace("%language%",(0,n.getLanguageNameFromCode)(t)),e)}getHeaders(){let e=new Headers;return e.append("Authorization",`Bearer ${this.apiKey}`),e.append("Content-Type","application/json"),e}async manageMessageContent(e,t){let{signal:a,clearAbortSignalWithTimeout:o}=this.createAbortSignalWithTimeout(this.servicesTimeout),s=JSON.stringify({model:this.model,messages:[{role:"system",content:e},{role:"user",content:t}],temperature:this.temperature}),r={method:"POST",headers:this.getHeaders(),body:s,redirect:"follow",signal:a},n=await fetch("https://api.x.ai/v1/chat/completions",r);if(o(),!n.ok){let e=await n.json();throw Error(`xAI error: ${e.error}`)}return(await n.json()).choices[0].message.content}}let y={anthropic:i,deepseek:u,google:l,groq:m.GroqProvider,lms:d.LmsProvider,mistral:c,ollama:h.OllamaProvider,openai:p,xai:C};class S{static getInstance(e){return new(y[e.llmProvider]||g.GenericProvider)(e)}}function T(e){e&&(document.querySelectorAll("fieldset [required]").forEach(e=>{e.removeAttribute("required")}),document.querySelectorAll(`fieldset#${e} [data-required]`).forEach(e=>{e.setAttribute("required","required")}),document.querySelector("body").setAttribute("data-provider",e))}(0,n.localizeNodes)(),document.querySelector("#llmProvider").addEventListener("change",e=>{T(e.target.value)}),document.querySelector("#llmTemperature").addEventListener("input",e=>{document.querySelector("label[for=llmTemperature] span").innerText=Number.parseFloat(e.currentTarget.value).toFixed(2)}),document.querySelectorAll("#optionsForm input").forEach(e=>{e.addEventListener("input",()=>{document.querySelector("#optionsForm button.test").disabled=!0})}),document.querySelectorAll("#optionsForm select").forEach(e=>{e.addEventListener("change",()=>{document.querySelector("#optionsForm button.test").disabled=!0})}),document.querySelector("#optionsForm button.test").addEventListener("click",async e=>{e.target.disabled=!0,e.target.classList.add("testing");let t=await (0,n.getConfigs)();S.getInstance(t).testIntegration().then(()=>{document.querySelector("#optionsForm #testResult").classList.add("ok"),document.querySelector("#optionsForm #testResult .message").innerHTML=browser.i18n.getMessage("options.testSuccessful")}).catch(e=>{document.querySelector("#optionsForm #testResult").classList.add("ko"),document.querySelector("#optionsForm #testResult .message").innerHTML=e.message}).finally(()=>{document.querySelector("#optionsForm button.test").classList.remove("testing")})}),document.querySelector("#testResult .close-icon").addEventListener("click",async e=>{document.querySelector("#optionsForm #testResult").classList.remove("ok","ko"),document.querySelector("#optionsForm button.test").disabled=!1}),document.querySelector("#optionsForm").addEventListener("submit",async e=>{if(e.preventDefault(),!e.currentTarget.checkValidity())return void e.currentTarget.classList.add("submit-attempt");let t={mainUserLanguageCode:document.querySelector("#mainUserLanguageCode").value,translationLanguageCodes:document.querySelector("#translationLanguageCodes").getValues(),llmProvider:document.querySelector("#llmProvider").value,temperature:Number.parseFloat(document.querySelector("#llmTemperature").value),servicesTimeout:Number.parseInt(document.querySelector("#servicesTimeout").value),maskPii:document.querySelector("#maskPii").checked,debugMode:document.querySelector("#debugMode").checked,anthropic:{apiKey:document.querySelector("#anthropicApiKey").value,model:document.querySelector("#anthropicModel").value},deepseek:{apiKey:document.querySelector("#deepseekApiKey").value},google:{apiKey:document.querySelector("#googleApiKey").value,model:document.querySelector("#googleModel").value},groq:{apiKey:document.querySelector("#groqApiKey").value,model:document.querySelector("#groqModel").value},lms:{serviceUrl:document.querySelector("#lmsServiceUrl").value,model:document.querySelector("#lmsModel").value},mistral:{apiKey:document.querySelector("#mistralApiKey").value,model:document.querySelector("#mistralModel").value},ollama:{serviceUrl:document.querySelector("#ollamaServiceUrl").value,model:document.querySelector("#ollamaModel").value},openai:{apiKey:document.querySelector("#openaiApiKey").value,organizationId:document.querySelector("#openaiOrganizationId").value,model:document.querySelector("#openaiModel").value,text2speech:{audioQuality:document.querySelector("#openaiText2SpeechAudioQuality").value,voice:document.querySelector("#openaiText2SpeechVoice").value,speed:Number.parseFloat(document.querySelector("#openaiText2SpeechSpeed").value)}},xai:{apiKey:document.querySelector("#xaiApiKey").value,model:document.querySelector("#xaiModel").value}};browser.storage.sync.set(t),document.querySelector("#saveOK").classList.add("show"),setTimeout(()=>{document.querySelector("#saveOK").classList.remove("show")},3e3),document.querySelector("#optionsForm button.test").removeAttribute("disabled"),browser.runtime.sendMessage({type:"optionsChanged"})}),document.addEventListener("DOMContentLoaded",async e=>{let t=await (0,n.getConfigs)(),a=t.llmProvider;document.querySelector("#llmTemperature").value=(t.temperature||.25).toString(),document.querySelector("label[for=llmTemperature] span").innerText=Number.parseFloat(document.querySelector("#llmTemperature").value).toFixed(2);let o=browser.i18n.getUILanguage().split("-")[0];document.querySelector("#mainUserLanguageCode").value=t.mainUserLanguageCode||o,document.querySelector("#translationLanguageCodes").setValues(t.translationLanguageCodes||[]),document.querySelector("#llmProvider").value=a,document.querySelector("#servicesTimeout").value=(t.servicesTimeout||12).toString(),document.querySelector("#maskPii").checked=t.maskPii,document.querySelector("#debugMode").checked=t.debugMode,document.querySelector("#anthropicApiKey").value=t.anthropic?.apiKey||"",t.anthropic?.model&&(document.querySelector("#anthropicModel").value=t.anthropic.model),document.querySelector("#deepseekApiKey").value=t.deepseek?.apiKey||"",document.querySelector("#googleApiKey").value=t.google?.apiKey||"",t.google?.model&&(document.querySelector("#googleModel").value=t.google.model),document.querySelector("#groqApiKey").value=t.groq?.apiKey||"",document.querySelector("#groqModel").value=t.groq?.model||"",document.querySelector("#lmsServiceUrl").value=t.lms?.serviceUrl||"http://localhost:1234",document.querySelector("#lmsModel").value=t.lms?.model||"",document.querySelector("#mistralApiKey").value=t.mistral?.apiKey||"",t.mistral?.model&&(document.querySelector("#mistralModel").value=t.mistral.model),document.querySelector("#ollamaServiceUrl").value=t.ollama?.serviceUrl||"http://localhost:11434",document.querySelector("#ollamaModel").value=t.ollama?.model||"",document.querySelector("#openaiApiKey").value=t.openai?.apiKey||"",document.querySelector("#openaiOrganizationId").value=t.openai?.organizationId||"",t.openai?.model&&(document.querySelector("#openaiModel").value=t.openai.model),document.querySelector("#openaiText2SpeechAudioQuality").value=t.openai?.text2speech?.audioQuality||"tts-1",document.querySelector("#openaiText2SpeechVoice").value=t.openai?.text2speech?.voice||"onyx",document.querySelector("#openaiText2SpeechVoicePreview audio").setAttribute("src",`https://cdn.openai.com/API/docs/audio/${document.querySelector("#openaiText2SpeechVoice").value}.wav`),document.querySelector("#openaiText2SpeechSpeed").value=(t.openai?.text2speech?.speed||1).toString(),document.querySelector("label[for=openaiText2SpeechSpeed] span").innerText=Number.parseFloat(document.querySelector("#openaiText2SpeechSpeed").value).toFixed(2),document.querySelector("#xaiApiKey").value=t.xai?.apiKey||"",t.xai?.model&&(document.querySelector("#xaiModel").value=t.xai.model),T(a),(await messenger.accounts.list(!1)).some(e=>e.type.endsWith("owl"))&&document.querySelector("#owlForExchangeBug").classList.add("show"),a&&document.querySelector("#optionsForm button.test").removeAttribute("disabled")});