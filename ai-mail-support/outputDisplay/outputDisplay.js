(()=>{class e{createBarChart(e,t=null){let r=document.createElement("div");r.id="chart";let a=Object.keys(e),n=Object.values(e);for(let e=0;e<a.length;++e){let s=document.createElement("div");s.classList.add("row");let l=document.createElement("div");l.classList.add("label"),l.innerText=a[e];let o=document.createElement("div");o.classList.add("bar-wrapper"),o.setAttribute("data-value",`${n[e]}%`);let c=document.createElement("div");c.classList.add("bar"),c.style.width=`${n[e]}%`,null!=t&&n[e]>=t&&c.classList.add("unsafe-value"),o.appendChild(c),s.appendChild(l),s.appendChild(o),r.appendChild(s)}return r}}var t={};function r(){return document.querySelector("#amsOuterResponse")?.shadowRoot?.querySelector("#amsInnerResponse")}function a(e=!1){if(e)return void document.querySelector("#amsOuterResponse").remove();document.querySelector("#amsOuterResponse").classList.contains("show")||document.querySelector("#amsOuterResponse").classList.add("show"),r().classList.remove("error"),r().classList.remove("thinking"),r().querySelector("#amsContent").innerHTML=""}t=function(e,t){(t=t||{}).listUnicodeChar=!!t.hasOwnProperty("listUnicodeChar")&&t.listUnicodeChar,t.stripListLeaders=!t.hasOwnProperty("stripListLeaders")||t.stripListLeaders,t.gfm=!t.hasOwnProperty("gfm")||t.gfm,t.useImgAltText=!t.hasOwnProperty("useImgAltText")||t.useImgAltText,t.abbr=!!t.hasOwnProperty("abbr")&&t.abbr,t.replaceLinksWithURL=!!t.hasOwnProperty("replaceLinksWithURL")&&t.replaceLinksWithURL,t.htmlTagsToSkip=t.hasOwnProperty("htmlTagsToSkip")?t.htmlTagsToSkip:[],t.throwError=!!t.hasOwnProperty("throwError")&&t.throwError;var r=e||"";r=r.replace(/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/gm,"");try{t.stripListLeaders&&(r=t.listUnicodeChar?r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,t.listUnicodeChar+" $1"):r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),t.gfm&&(r=r.replace(/\n={2,}/g,"\n").replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/```(?:.*)\n([\s\S]*?)```/g,(e,t)=>t.trim())),t.abbr&&(r=r.replace(/\*\[.*\]:.*\n/,""));let e=/<[^>]*>/g;if(t.htmlTagsToSkip&&t.htmlTagsToSkip.length>0){let r=t.htmlTagsToSkip.join("|");e=RegExp(`<(?!/?(${r})(?=>|s[^>]*>))[^>]*>`,"g")}r=r.replace(e,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,t.useImgAltText?"$1":"").replace(/\[([\s\S]*?)\]\s*[\(\[].*?[\)\]]/g,t.replaceLinksWithURL?"$2":"$1").replace(/^(\n)?\s{0,3}>\s?/gm,"$1").replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s*( (.+))? +#+$|^(\n)?\s{0,}#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/([\*]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(^|\W)([_]+)(\S)(.*?\S)??\2($|\W)/g,"$1$3$4$5").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1")}catch(r){if(t.throwError)throw r;return console.error("remove-markdown encountered error: %s",r),e}return r},(async()=>{browser.runtime.onMessage.addListener(async n=>{var s,l;if(n?.type)switch(function(){if(document.querySelector("#amsOuterResponse"))return;let e=document.createElement("div");e.id="amsOuterResponse";let t=e.attachShadow({mode:"open"}),r=document.createElement("div");r.id="amsInnerResponse",t.appendChild(r);let n=document.createElement("link");n.rel="stylesheet",n.href=browser.runtime.getURL("/outputDisplay/outputDisplay.css"),r.appendChild(n);let s=document.createElement("img");s.id="amsImage",s.src=browser.runtime.getURL("/images/bot-icon-color-64.webp"),r.appendChild(s);let l=document.createElement("div");l.id="amsContent",r.appendChild(l);let o=document.createElement("span");o.className="close-icon",o.innerHTML="&times;",o.addEventListener("click",()=>a(!0)),r.appendChild(o),document.body.appendChild(e)}(),n.type){case"addAudio":!function(e){a();let t=new FileReader;t.onload=()=>{let e=t.result,a=document.createElement("audio");a.src=e,a.autoplay=!0,a.controls=!0,r().querySelector("#amsContent").appendChild(a)},t.readAsDataURL(e)}(n.content);break;case"addChart":!function(t){a();let n=new e;r().querySelector("#amsContent").append(n.createBarChart(t,50))}(n.content);break;case"addText":!function(e){var n;a();let s=((n=t)&&n.__esModule?n.default:n)(e);r().querySelector("#amsContent").textContent=s}(n.content);break;case"showError":s=n.content,a(),r().classList.add("error"),r().querySelector("#amsContent").textContent=s;break;case"thinking":l=n.content,a(),r().classList.add("thinking"),r().querySelector("#amsContent").innerHTML=`${l}<span class="dots"></span>`}})})()})();