(()=>{class e{createBarChart(e,t=null){let r=document.createElement("div");r.id="chart";let a=Object.keys(e),n=Object.values(e);for(let e=0;e<a.length;++e){let s=document.createElement("div");s.classList.add("row");let o=document.createElement("div");o.classList.add("label"),o.innerText=a[e];let l=document.createElement("div");l.classList.add("bar-wrapper"),l.setAttribute("data-value",`${n[e]}%`);let c=document.createElement("div");c.classList.add("bar"),c.style.width=`${n[e]}%`,null!=t&&n[e]>=t&&c.classList.add("unsafe-value"),l.appendChild(c),s.appendChild(o),s.appendChild(l),r.appendChild(s)}return r}}let t=((n={}).CREDIT_CARD="CREDIT_CARD",n.CRYPTO="CRYPTO",n.DATE_TIME="DATE_TIME",n.EMAIL_ADDRESS="EMAIL_ADDRESS",n.IBAN_CODE="IBAN_CODE",n.IP_ADDRESS="IP_ADDRESS",n.PHONE_NUMBER="PHONE_NUMBER",n.URL="URL",n.CVV="CVV",n.BIC_SWIFT="BIC_SWIFT",n.US_BANK_NUMBER="US_BANK_NUMBER",n.US_DRIVER_LICENSE="US_DRIVER_LICENSE",n.US_ITIN="US_ITIN",n.US_PASSPORT="US_PASSPORT",n.US_SSN="US_SSN",n.UK_NHS="UK_NHS",n.UK_NINO="UK_NINO",n.ES_NIF="ES_NIF",n.ES_NIE="ES_NIE",n.IT_FISCAL_CODE="IT_FISCAL_CODE",n.IT_DOCUMENT="IT_DOCUMENT",n.IT_VAT_CODE="IT_VAT_CODE",n.PL_PESEL="PL_PESEL",n.FI_PERSONAL_IDENTITY_CODE="FI_PERSONAL_IDENTITY_CODE",n.SG_NRIC_FIN="SG_NRIC_FIN",n.SG_UEN="SG_UEN",n.AU_ABN="AU_ABN",n.AU_ACN="AU_ACN",n.AU_TFN="AU_TFN",n.AU_MEDICARE="AU_MEDICARE",n.IN_PAN="IN_PAN",n.IN_AADHAAR="IN_AADHAAR",n.IN_VEHICLE_REGISTRATION="IN_VEHICLE_REGISTRATION",n.IN_VOTER="IN_VOTER",n.IN_PASSPORT="IN_PASSPORT",n.KR_RRN="KR_RRN",n);async function r(e){let t=null;try{t=(await browser.storage.sync.get(e))[e]}catch(t){a(`An error occurred while retrieving the config for ${e}: ${t}`,"error")}return t}async function a(e,t="log"){!0===await r("debugMode")&&console[t](`AI Mail Support: ${e}`)}RegExp("(?:(?:[sS][wW][iI][fF][tT])|(?:[bB][iI][cC])|(?:[bB][aA][nN][kK][\\s-]?[cC][oO][dD][eE])|(?:[sS][wW][iI][fF][tT][\\s-]?[cC][oO][dD][eE])|(?:[bB][iI][cC][\\s-]?[cC][oO][dD][eE]))[:\\s=]+([A-Z]{4}[A-Z]{2}[A-Z0-9]{2}(?:[A-Z0-9]{3})?)\\b","g"),t.CREDIT_CARD,t.CRYPTO,t.DATE_TIME,t.EMAIL_ADDRESS,RegExp("(?<=[?&=/])[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}","g"),t.IBAN_CODE,t.IP_ADDRESS,t.PHONE_NUMBER,t.URL,t.CVV,t.BIC_SWIFT,t.US_BANK_NUMBER,t.US_DRIVER_LICENSE,t.US_ITIN,t.US_PASSPORT,t.US_SSN,t.UK_NHS,t.UK_NINO,t.ES_NIF,t.ES_NIE,t.IT_FISCAL_CODE,t.IT_DOCUMENT,t.IT_VAT_CODE,t.PL_PESEL,t.FI_PERSONAL_IDENTITY_CODE,t.SG_NRIC_FIN,t.SG_UEN,t.AU_ABN,t.AU_ACN,t.AU_TFN,t.AU_MEDICARE,t.IN_PAN,t.IN_AADHAAR,t.IN_VEHICLE_REGISTRATION,t.IN_VOTER,t.IN_PASSPORT,t.KR_RRN;var n,s={};function o(){return document.querySelector("#amsOuterResponse")?.shadowRoot?.querySelector("#amsInnerResponse")}function l(e=!1){e?document.querySelector("#amsOuterResponse").remove():(document.querySelector("#amsOuterResponse").classList.contains("show")||document.querySelector("#amsOuterResponse").classList.add("show"),o().classList.remove("error","text-content","thinking"),o().querySelector("#amsContent").innerHTML="")}s=function(e,t){(t=t||{}).listUnicodeChar=!!t.hasOwnProperty("listUnicodeChar")&&t.listUnicodeChar,t.stripListLeaders=!t.hasOwnProperty("stripListLeaders")||t.stripListLeaders,t.gfm=!t.hasOwnProperty("gfm")||t.gfm,t.useImgAltText=!t.hasOwnProperty("useImgAltText")||t.useImgAltText,t.abbr=!!t.hasOwnProperty("abbr")&&t.abbr,t.replaceLinksWithURL=!!t.hasOwnProperty("replaceLinksWithURL")&&t.replaceLinksWithURL,t.separateLinksAndTexts=t.hasOwnProperty("separateLinksAndTexts")?t.separateLinksAndTexts:null,t.htmlTagsToSkip=t.hasOwnProperty("htmlTagsToSkip")?t.htmlTagsToSkip:[],t.throwError=!!t.hasOwnProperty("throwError")&&t.throwError;var r=e||"";r=r.replace(/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/gm,"");try{t.stripListLeaders&&(r=t.listUnicodeChar?r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,t.listUnicodeChar+" $1"):r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),t.gfm&&(r=r.replace(/\n={2,}/g,"\n").replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/```(?:.*)\n([\s\S]*?)```/g,(e,t)=>t.trim())),t.abbr&&(r=r.replace(/\*\[.*\]:.*\n/,""));let e=/<[^>]*>/g;if(t.htmlTagsToSkip&&t.htmlTagsToSkip.length>0){let r=t.htmlTagsToSkip.join("|");e=RegExp(`<(?!/?(${r})(?=>|s[^>]*>))[^>]*>`,"g")}t.separateLinksAndTexts&&(r=r.replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1"+t.separateLinksAndTexts+"$2")),r=r.replace(e,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,t.useImgAltText?"$1":"").replace(/\[([\s\S]*?)\]\s*[\(\[].*?[\)\]]/g,t.replaceLinksWithURL?"$2":"$1").replace(/^(\n)?\s{0,3}>\s?/gm,"$1").replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s*( (.+))? +#+$|^(\n)?\s{0,}#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/([\*]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(^|\W)([_]+)(\S)(.*?\S)??\2($|\W)/g,"$1$3$4$5").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1")}catch(r){if(t.throwError)throw r;return console.error("remove-markdown encountered error: %s",r),e}return r},browser.runtime.onMessage.addListener(async t=>{var r,n,c,i,d,_;if(t?.type)switch(function(){if(document.querySelector("#amsOuterResponse"))return;let e=document.createElement("div");e.id="amsOuterResponse";let t=e.attachShadow({mode:"open"}),r=document.createElement("div");r.id="amsInnerResponse",t.appendChild(r);let n=document.createElement("link");n.rel="stylesheet",n.href=browser.runtime.getURL("/outputDisplay/outputDisplay.css"),r.appendChild(n);let s=document.createElement("img");s.id="amsImage",s.src=browser.runtime.getURL("/images/bot-icon-color-64.webp"),r.appendChild(s);let c=document.createElement("div");c.id="amsContent",r.appendChild(c);let i=document.createElement("span");i.className="close-icon",i.innerHTML="&times;",i.addEventListener("click",()=>l(!0)),r.appendChild(i);let d=document.createElement("div");d.id="actionsContainer";let _=document.createElement("span");_.className="copy-clipboard-icon",_.innerHTML="&#128203;",_.addEventListener("click",()=>(function(){let e=o().querySelector("#amsContent"),t=globalThis.getSelection(),r=document.createRange();r.selectNodeContents(e),t.removeAllRanges(),t.addRange(r);try{document.execCommand("copy")}catch{a("Copy to clipboard failed or was blocked","error")}finally{t.removeAllRanges()}})()),d.appendChild(_),r.appendChild(d),document.body.appendChild(e)}(),t.type){case"addAudio":let E;r=t.content,l(),(E=new FileReader).onload=()=>{let e=E.result,t=document.createElement("audio");t.src=e,t.autoplay=!0,t.controls=!0,o().querySelector("#amsContent").appendChild(t)},E.readAsDataURL(r);break;case"addChart":let p;n=t.content,l(),p=new e,o().querySelector("#amsContent").append(p.createBarChart(n,50));break;case"addText":let S;c=t.content,l(),o().classList.add("text-content"),S=((i=s)&&i.__esModule?i.default:i)(c),o().querySelector("#amsContent").textContent=S;break;case"showError":d=t.content,l(),o().classList.add("error"),o().querySelector("#amsContent").textContent=d;break;case"thinking":_=t.content,l(),o().classList.add("thinking"),o().querySelector("#amsContent").innerHTML=`${_}<span class="dots"></span>`}})})();